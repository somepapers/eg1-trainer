<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EG1 Trainer </title>
<style>
body{
    font-family: Arial;
    text-align:center;
    background:#111;
    color:white;
}
button{
    padding:10px 16px;
    margin:6px;
    font-size:15px;
    border:none;
    border-radius:8px;
}
#scramble{
    font-size:20px;
    margin:18px;
}
.casebox label{
    margin:5px;
}
.hidden{display:none;}
table{
    margin:auto;
    border-collapse:collapse;
}
td,th{
    border:1px solid white;
    padding:6px 10px;
}
#result{
    font-size:22px;
    margin:15px;
    white-space:pre-line;
}
.small{
    font-size:12px;
}
</style>
</head>
<body>

<button onclick="showPage(1)">训练</button>
<button onclick="showPage(2)">统计</button>

<!-- 训练界面 -->
<div id="page1">
<h2>EG1 Training</h2>

<div class="casebox">
<label><input type="checkbox" checked value="H">H</label>
<label><input type="checkbox" checked value="Pi">Pi</label>
<label><input type="checkbox" checked value="T">T</label>
<label><input type="checkbox" checked value="L">L</label>
<label><input type="checkbox" checked value="U">U</label>
<label><input type="checkbox" checked value="S">S</label>
<label><input type="checkbox" checked value="AS">AS</label>
</div>

<div id="shape"></div>
<div id="scramble"></div>

<button onclick="nextScramble()">下一条</button>

<br><br>

<button onclick="correct()">做对了</button>
<button onclick="wrong()">做错了</button>

<div id="result"></div>
</div>

<!-- 统计界面 -->
<div id="page2" class="hidden">
<h2>Case统计</h2>
<table>
<tr><th>Case</th><th>正确</th><th>错误</th></tr>
<tbody id="caseStats"></tbody>
</table>

<h2>公式统计</h2>
<table>
<tr><th>Case</th><th>公式</th><th>正确</th><th>错误</th></tr>
<tbody id="algStats"></tbody>
</table>

<br>
<button onclick="resetStats()">清空所有统计</button>
</div>

<script>

// ====== 公式库 ======
const algs = {
"H":[
"R' F R2 U' R' F R U R' F'",
"F' U R U' R2 F2 R U' F",
"R' F R F' U2 F R U2 R' F",
"R U R' F' R U R' U' R U R'"
],
"Pi":[
"F2 R U R' U2 R U R' U' F",
"R' F R2 U' R2 F R",
"F R' F U' F2 R U R",
"R U' R' U R U' R' F R U' R'",
"R U R' U R U' R2 F' R F R' F' R",
"L' U' L U' L' U L2 F L' F' L F L'"
],
"T":[
"F L F' L2 U' L U L' U' L",
"F' R' F R2 U R' U' R U R'",
"R U' R2 F R U R U2 R'",
"R U' R' F' U' F R' F' R F",
"R U R2 F' R F R' F' R",
"R U' R' U2 F R U2 R' F"
],
"L":[
"R U' R' U R U' R2 F' R F",
"L' U L U' L' U L2 F L' F'",
"R' U R2 U' R2 U' F R2 U' R'",
"R U2 R' F R U' R2 F' R",
"R U R' F' R U R' U' F R' F' R",
"L' U' L F L' U' L U F' L F L'"
],
"U":[
"R U' R2 F R2 U R' U' R U' R'",
"R U' R' U R U' R' F R U2 R' F R' F' R",
"R U' R2 F2 R F' U R U R'",
"R' F R F' R' F R2 U' R'",
"R U' R' U R U' R' U R' F' R F",
"L' U L U' L' U L U' L F L' F'"
],
"S":[
"R U R' U F R U' R2 F' R",
"F R' F' R F R U' R' U R' F' R",
"F R' F' R U R' F' R2 U R'",
"F' R' F R2 U R' U' F R' F' R",
"R U2 R' U R' F' R F R' F R",
"R' F R2 U' R' U R U' R' F"
],
"AS":[
"R' F R2 U R' F' U' R U' R'",
"R' F R U' R U R' F' R' F R F'",
"F' R U R' U' R U R2 F' R",
"R' F R F' U R U' R2 F' R F",
"R' F2 R U' R U R' F' R U' R'",
"R U' R2 F R U' R' F R F'"
]
}

// ===== 数据结构 =====
let statsCase={}
let statsAlg={}

// 初始化
function initStats(){
    for(let c in algs){
        statsCase[c]={correct:0,wrong:0}
        algs[c].forEach(a=>{
            statsAlg[a]={case:c,correct:0,wrong:0}
        })
    }
}

// ===== 本地存储 =====
function saveStats(){
    localStorage.setItem("eg1_case",JSON.stringify(statsCase))
    localStorage.setItem("eg1_alg",JSON.stringify(statsAlg))
}

function loadStats(){
    let c=localStorage.getItem("eg1_case")
    let a=localStorage.getItem("eg1_alg")
    if(c && a){
        statsCase=JSON.parse(c)
        statsAlg=JSON.parse(a)
    }else{
        initStats()
    }
}

function resetStats(){
    localStorage.clear()
    initStats()
    updateStats()
}

// ===== 当前状态 =====
let currentAlg=""
let currentCase=""

// ===== 工具 =====
function invertAlg(alg){
    return alg.split(" ").reverse().map(m=>{
        if(m.includes("'")) return m.replace("'","");
        if(m.includes("2")) return m;
        return m+"'"
    }).join(" ")
}

function getSelectedCases(){
    return Array.from(document.querySelectorAll("input:checked")).map(b=>b.value)
}

// ===== 生成 =====
function nextScramble(){
    let selected=getSelectedCases()
    let pool=[]
    selected.forEach(c=>{
        algs[c].forEach(a=>pool.push({case:c,alg:a}))
    })
    let r=pool[Math.floor(Math.random()*pool.length)]
    currentAlg=r.alg
    currentCase=r.case

    document.getElementById("shape").innerText="形状: "+r.case
    document.getElementById("scramble").innerText=invertAlg(r.alg)
    document.getElementById("result").innerText=""
}

// ===== 判定 =====
function markCorrect() {
    stats[currentFormula].correct++;
    saveStats();

    showMessage("蒸蚌");

    setTimeout(() => {
        nextScramble();
    }, 2000);
}

function wrong(){
    statsCase[currentCase].wrong++
    statsAlg[currentAlg].wrong++
    saveStats()
    document.getElementById("result").innerText=
    "正确公式：\n"+currentAlg+"\n菜就多练"
    updateStats()
}

// ===== 更新统计显示 =====
function updateStats(){
    let caseHTML=""
    for(let c in statsCase){
        caseHTML+=`<tr>
        <td>${c}</td>
        <td>${statsCase[c].correct}</td>
        <td>${statsCase[c].wrong}</td>
        </tr>`
    }
    document.getElementById("caseStats").innerHTML=caseHTML

    let algHTML=""
    for(let a in statsAlg){
        algHTML+=`<tr>
        <td>${statsAlg[a].case}</td>
        <td class="small">${a}</td>
        <td>${statsAlg[a].correct}</td>
        <td>${statsAlg[a].wrong}</td>
        </tr>`
    }
    document.getElementById("algStats").innerHTML=algHTML
}

function showPage(n){
    document.getElementById("page1").classList.toggle("hidden",n!=1)
    document.getElementById("page2").classList.toggle("hidden",n!=2)
}

// ===== 启动 =====
loadStats()
updateStats()
nextScramble()

</script>
</body>
</html>

